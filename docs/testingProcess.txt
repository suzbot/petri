## Testing

### Process

1. **Clarify functional intent** - For complex features, discuss expected behavior before coding. Use Gherkin-style scenarios when helpful, but not required as formal documents.
2. **Write tests first** - Use TDD process, Define expected behavior in test form.
3. **Implement feature** - Write minimum code to pass tests.
4. **Refactor** - Clean up while keeping tests green.
5. **Regression tests for bugs** - When fixing bugs, add a regression test to prevent recurrence.
6. Run all tests

**During Testing:**

- Allow the user to save tokens by prompting them to run the build instead of running it yourself. Human will return any tests that need to be fixed.
- **Track balance tuning discoveries**: When testing reveals balance issues (rates too fast/slow, etc.), add notes to docs/futureEnhancements.md for future tuning pass.

### What to Test

- **Core logic**: Tier calculations, intent priority, survival mechanics, stat changes
- **Behavior correctness**: System interactions, state transitions
- **Invariants**: Multi-tick simulation tests (no position conflicts, consistent state)
- **Regression**: Specific bugs that were fixed

### What NOT to Test

- **UI rendering** (view.go) - Visual verification done manually
- **Bubble Tea integration** - Framework responsibility
- **Exact log message wording** - Brittle; test that events ARE logged, not exact text
- **Configuration constants** - Just values, no logic

### Balance Observation Tests

Headless simulation tests for measuring game balance. Located in `internal/simulation/observation_test.go`

   Run all observation tests:

     ```bash
     go test -v -run TestObserve ./internal/simulation/
     ```

     | Test                          | Purpose                                                      |
     | ----------------------------- | ------------------------------------------------------------ |
     | `TestObserveBalanceMetrics`   | 5 runs Ã— 300s: survival rate, mood distribution, preferences |
     | `TestObserveFoodScarcity`     | Tracks food availability vs consumption over time            |
     | `TestObserveFlowerGrowth`     | Monitors flower population growth                            |
     | `TestObserveTimeToFirstDeath` | 10 runs: measures time until first death                     |
     | `TestObserveDeathProgression` | Single extended run tracking all deaths                      |

   Results are documented in `docs/futureEnancements.md` under "Balance Observation Results".

